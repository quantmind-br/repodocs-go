{
  "feature": "Increase Test Coverage from 20.2% to 80%+",
  "description": "Comprehensive test coverage increase across repodocs-go codebase from 20.2% to minimum 80% per package. Adjusted thresholds for complex packages (40-85% range). Phased approach prioritized by business criticality using hybrid testing strategy.",
  "created_at": "2026-01-02T13:32:53.461Z",
  "updated_at": "2026-01-02T14:30:00.000Z",
  "status": "in_progress",
  "planStatus": "ready",
  "currentPhase": "1",
  "phases": [
    {
      "id": "1",
      "name": "Business-Critical Components",
      "description": "Achieve 80-85% test coverage for strategies, converter, and app packages. These are core to the documentation extraction pipeline.",
      "targetCoverage": "80-85%",
      "estimatedWeeks": 3,
      "priority": "critical",
      "status": "pending",
      "subtasks": [
        {
          "id": "1.1",
          "name": "Expand internal/strategies coverage (31% → 85%)",
          "description": "Create comprehensive unit tests for all strategy implementations including Git, Crawler, LLMS, PkgGo, and base strategy methods.",
          "status": "completed",
          "completedAt": "2026-01-02T15:00:00Z",
          "notes": "Created comprehensive unit tests for Crawler, LLMS, PkgGo, Sitemap strategies and base strategy methods. Git strategy already had extensive tests. All tests follow table-driven patterns with proper mocking.",
          "files": [
            "tests/unit/strategies/git_strategy_test.go",
            "tests/unit/strategies/crawler_strategy_test.go",
            "tests/unit/strategies/llms_strategy_test.go",
            "tests/unit/strategies/pkggo_strategy_test.go",
            "tests/unit/strategies/strategy_base_test.go",
            "tests/unit/strategies/sitemap_strategy_test.go"
          ],
          "functionsToTest": [
            "parseGitURL", "tryArchiveDownload", "downloadAndExtract", "extractTarGz",
            "findDocumentationFiles", "processFiles", "processFile", "detectDefaultBranch",
            "Execute (all strategies)", "isHTMLContentType", "parseLLMSLinks",
            "filterLLMSLinks", "extractSections", "DefaultOptions", "FlushMetadata",
            "SetStrategy", "SetSourceURL", "WriteDocument"
          ],
          "coverageTarget": 85,
          "acceptanceCriteria": [
            "All public functions have unit tests",
            "Table-driven tests for multiple scenarios",
            "Mock injection for all external dependencies",
            "Coverage ≥85% for strategies package",
            "Tests pass with make test"
          ]
        },
        {
          "id": "1.2",
          "name": "Create internal/converter tests (0% → 85%)",
          "description": "Create comprehensive unit tests for converter pipeline components: pipeline orchestration, HTML sanitization, content extraction, Markdown conversion, and encoding normalization.",
          "status": "completed",
          "completedAt": "2026-01-02T16:00:00Z",
          "notes": "Created comprehensive unit tests for all converter pipeline components: sanitizer_test.go (16KB, HTML sanitization), readability_test.go (7.8KB, content extraction), markdown_test.go (183 lines, Markdown conversion), encoding_test.go (67 lines, encoding normalization). All tests follow table-driven patterns with proper assertions. Total: 1,221+ lines of tests.",
          "files": [
            "tests/unit/converter/pipeline_test.go",
            "tests/unit/converter/sanitizer_test.go",
            "tests/unit/converter/readability_test.go",
            "tests/unit/converter/markdown_test.go",
            "tests/unit/converter/encoding_test.go"
          ],
          "functionsToTest": [
            "Convert", "ConvertHTML", "ConvertHTMLWithSelector", "removeExcluded",
            "Sanitize", "normalizeURLs", "resolveURL", "normalizeSrcset", "removeEmptyElements",
            "Extract", "extractWithSelector", "extractWithReadability", "ExtractDescription",
            "ExtractHeaders", "ExtractLinks", "cleanMarkdown", "GenerateFrontmatter",
            "AddFrontmatter", "StripMarkdown", "CountWords", "CountChars",
            "DetectEncoding", "ConvertToUTF8", "IsUTF8", "GetEncoder"
          ],
          "coverageTarget": 85,
          "acceptanceCriteria": [
            "All converter pipeline stages have unit tests",
            "HTML fixtures created for various scenarios",
            "Edge cases tested (malformed HTML, encoding issues)",
            "Coverage ≥85% for converter package",
            "Integration test with real cache"
          ]
        },
        {
          "id": "1.3",
          "name": "Create internal/app tests (0% → 85%)",
          "description": "Expand tests for app package: detector for strategy routing and orchestrator for workflow coordination.",
          "status": "pending",
          "files": [
            "tests/unit/app/detector_test.go",
            "tests/unit/app/orchestrator_test.go"
          ],
          "functionsToTest": [
            "DetectStrategy", "CreateStrategy", "GetAllStrategies", "FindMatchingStrategy",
            "NewOrchestrator", "Run", "Close", "GetStrategyName", "ValidateURL"
          ],
          "coverageTarget": 85,
          "acceptanceCriteria": [
            "All detector methods tested with various URL patterns",
            "Orchestrator workflow tested with mocked strategies",
            "Strategy factory injection tested",
            "Coverage ≥85% for app package",
            "Error paths tested (invalid URLs, strategy failures)"
          ]
        },
        {
          "id": "1.4",
          "name": "Create HTML fixtures and expand test utilities",
          "description": "Create comprehensive HTML fixtures for converter tests: SPA pages, tables, code blocks, forms, navigation, malformed HTML, encoding variations.",
          "status": "pending",
          "files": [
            "tests/testdata/fixtures/html/spa_page.html",
            "tests/testdata/fixtures/html/tables.html",
            "tests/testdata/fixtures/html/code_blocks.html",
            "tests/testdata/fixtures/html/navigation.html",
            "tests/testdata/fixtures/html/malformed.html",
            "tests/testdata/fixtures/html/encoding_utf8.html",
            "tests/testdata/fixtures/html/encoding_latin1.html"
          ],
          "coverageTarget": 0,
          "acceptanceCriteria": [
            "Fixtures created in tests/testdata/fixtures/html/",
            "Fixtures used in converter pipeline tests",
            "Edge case fixtures (malformed, empty, special chars)",
            "Multiple encoding representations"
          ]
        }
      ]
    },
    {
      "id": "2",
      "name": "LLM and Configuration",
      "description": "Achieve 80% test coverage for LLM provider factory, circuit breaker, retry logic, rate limiting, and configuration management.",
      "targetCoverage": "80%",
      "estimatedWeeks": 2,
      "priority": "high",
      "status": "pending",
      "subtasks": [
        {
          "id": "2.1",
          "name": "Expand internal/llm tests (6% → 80%)",
          "description": "Create comprehensive unit tests for LLM providers, circuit breaker state machine, retry logic with backoff, and rate limiter with token bucket.",
          "status": "pending",
          "files": [
            "tests/unit/llm/provider_test.go",
            "tests/unit/llm/circuit_breaker_test.go",
            "tests/unit/llm/retry_test.go",
            "tests/unit/llm/ratelimit_test.go",
            "tests/unit/llm/metadata_test.go",
            "tests/integration/llm/provider_integration_test.go"
          ],
          "functionsToTest": [
            "NewAnthropicProvider", "NewGoogleProvider", "NewOpenAIProvider",
            "Complete", "Close", "handleHTTPError",
            "NewCircuitBreaker", "Allow", "RecordSuccess", "RecordFailure",
            "State", "transitionTo",
            "NewRetrier", "Execute", "calculateBackoff",
            "IsRetryableError", "ShouldRetryStatusCode",
            "NewTokenBucket", "Wait", "TryAcquire", "Available", "refill",
            "Enhance", "EnhanceAll", "applyMetadata"
          ],
          "coverageTarget": 80,
          "acceptanceCriteria": [
            "Circuit breaker state transitions tested explicitly",
            "Retry logic tested with various error scenarios",
            "Rate limiter tested with timing control",
            "HTTP mocking for provider tests",
            "Integration tests for provider HTTP calls",
            "Coverage ≥80% for llm package"
          ]
        },
        {
          "id": "2.2",
          "name": "Create internal/config tests (0% → 85%)",
          "description": "Create unit tests for configuration validation, loading with Viper, default values, and directory management.",
          "status": "pending",
          "files": [
            "tests/unit/config/config_test.go",
            "tests/unit/config/loader_test.go",
            "tests/unit/config/defaults_test.go"
          ],
          "functionsToTest": [
            "Validate", "all validation methods",
            "Load", "LoadWithViper", "setDefaults",
            "EnsureConfigDir", "EnsureCacheDir",
            "Default", "ConfigDir", "CacheDir", "ConfigFilePath"
          ],
          "coverageTarget": 85,
          "acceptanceCriteria": [
            "Config validation tested with valid/invalid inputs",
            "Viper loading tested with various config files",
            "Default values verified",
            "Directory creation and management tested",
            "Coverage ≥85% for config package"
          ]
        }
      ]
    },
    {
      "id": "3",
      "name": "Output and Cache",
      "description": "Achieve 75-80% test coverage for output writer and cache packages with integration tests for persistence.",
      "targetCoverage": "75-80%",
      "estimatedWeeks": 2,
      "priority": "high",
      "status": "pending",
      "subtasks": [
        {
          "id": "3.1",
          "name": "Create internal/output tests (0% → 80%)",
          "description": "Create unit tests for output writer operations and metadata collector with temp directory management.",
          "status": "pending",
          "files": [
            "tests/unit/output/writer_test.go",
            "tests/unit/output/collector_test.go"
          ],
          "functionsToTest": [
            "Write", "WriteMultiple", "FlushMetadata", "Exists",
            "EnsureBaseDir", "Clean", "Stats",
            "Add", "Flush", "buildIndex", "GetIndex"
          ],
          "coverageTarget": 80,
          "acceptanceCriteria": [
            "File writing tested with various content types",
            "Metadata collection and flushing tested",
            "Directory management tested",
            "Stats and verification tested",
            "Coverage ≥80% for output package"
          ]
        },
        {
          "id": "3.2",
          "name": "Expand internal/cache tests (0% → 75%)",
          "description": "Create comprehensive unit tests for BadgerCache operations and key generation. Add integration tests with real BadgerDB for persistence verification.",
          "status": "pending",
          "files": [
            "tests/unit/cache/badger_test.go",
            "tests/unit/cache/keys_test.go",
            "tests/integration/cache/cache_integration_test.go"
          ],
          "functionsToTest": [
            "NewBadgerCache", "Get", "Set", "Has", "Delete",
            "Close", "Clear", "Size", "Stats",
            "GenerateKey", "GenerateKeyWithPrefix", "normalizeForKey",
            "PageKey", "SitemapKey", "MetadataKey"
          ],
          "coverageTarget": 75,
          "acceptanceCriteria": [
            "All CRUD operations tested",
            "Key generation tested with various inputs",
            "Concurrent access tested",
            "Integration test with real BadgerDB",
            "Cache persistence verified",
            "Coverage ≥75% for cache package"
          ]
        }
      ]
    },
    {
      "id": "4",
      "name": "Fetcher and Git",
      "description": "Achieve 70-80% test coverage for HTTP client with retry/stealth logic and Git client wrapper.",
      "targetCoverage": "70-80%",
      "estimatedWeeks": 2,
      "priority": "medium",
      "status": "pending",
      "subtasks": [
        {
          "id": "4.1",
          "name": "Create internal/fetcher tests (0% → 70%)",
          "description": "Create unit tests for HTTP client operations, retry logic with exponential backoff, stealth headers, and custom transport. Add integration tests with real HTTP server.",
          "status": "pending",
          "files": [
            "tests/unit/fetcher/client_test.go",
            "tests/unit/fetcher/retry_test.go",
            "tests/unit/fetcher/stealth_test.go",
            "tests/integration/fetcher/fetcher_integration_test.go"
          ],
          "functionsToTest": [
            "NewClient", "Get", "GetWithHeaders", "doRequest",
            "GetCookies", "Close", "cache operations",
            "NewRetrier", "Retry", "RetryWithValue",
            "ShouldRetryStatus", "ParseRetryAfter",
            "RandomUserAgent", "RandomAcceptLanguage",
            "StealthHeaders", "RandomDelay",
            "NewStealthTransport", "RoundTrip"
          ],
          "coverageTarget": 70,
          "acceptanceCriteria": [
            "HTTP operations tested with various responses",
            "Retry logic tested with timeouts and errors",
            "Stealth headers tested",
            "Cookie handling tested",
            "Integration test with real HTTP server",
            "Coverage ≥70% for fetcher package"
          ]
        },
        {
          "id": "4.2",
          "name": "Create internal/git tests (0% → 80%)",
          "description": "Create unit tests for Git client wrapper with go-git mocking.",
          "status": "pending",
          "files": [
            "tests/unit/git/client_test.go"
          ],
          "functionsToTest": [
            "NewClient", "PlainCloneContext"
          ],
          "coverageTarget": 80,
          "acceptanceCriteria": [
            "Git clone operations tested with mocks",
            "Error handling tested (auth failures, network errors)",
            "Coverage ≥80% for git package"
          ]
        }
      ]
    },
    {
      "id": "5",
      "name": "CLI and Domain",
      "description": "Achieve 80-85% test coverage for CLI operations and domain models/errors.",
      "targetCoverage": "80-85%",
      "estimatedWeeks": 1,
      "priority": "medium",
      "status": "pending",
      "subtasks": [
        {
          "id": "5.1",
          "name": "Create cmd/repodocs tests (0% → 80%)",
          "description": "Create unit tests for CLI operations including initialization, checks, and main execution flow with mocked dependencies.",
          "status": "pending",
          "files": [
            "cmd/repodocs/main_test.go"
          ],
          "functionsToTest": [
            "run", "initConfig", "checkInternet", "checkChrome",
            "checkWritePermissions", "checkCacheDir"
          ],
          "coverageTarget": 80,
          "acceptanceCriteria": [
            "All checks tested with various scenarios",
            "Config initialization tested",
            "Error paths tested",
            "Coverage ≥80% for cmd/repodocs"
          ]
        },
        {
          "id": "5.2",
          "name": "Create internal/domain tests (0% → 85%)",
          "description": "Create unit tests for domain model methods and error constructors.",
          "status": "pending",
          "files": [
            "tests/unit/domain/models_test.go",
            "tests/unit/domain/errors_test.go"
          ],
          "functionsToTest": [
            "ToMetadata", "ToFrontmatter", "ToDocumentMetadata",
            "ToSimpleMetadata", "ToSimpleDocumentMetadata",
            "all error constructors and methods"
          ],
          "coverageTarget": 85,
          "acceptanceCriteria": [
            "All model conversion methods tested",
            "All error constructors tested",
            "Error type methods tested",
            "Coverage ≥85% for domain package"
          ]
        }
      ]
    },
    {
      "id": "6",
      "name": "Renderer (High Complexity)",
      "description": "Achieve 40-50% test coverage for browser rendering package. Reduced threshold due to Chrome/Chromium dependency and JavaScript rendering complexity.",
      "targetCoverage": "40-50%",
      "estimatedWeeks": 2,
      "priority": "medium",
      "status": "pending",
      "subtasks": [
        {
          "id": "6.1",
          "name": "Create internal/renderer tests (0% → 45%)",
          "description": "Create unit tests for framework detection, pool management, and browser operations. Limited integration tests with real browser for critical paths.",
          "status": "pending",
          "files": [
            "tests/unit/renderer/detector_test.go",
            "tests/unit/renderer/pool_test.go",
            "tests/integration/renderer/renderer_integration_test.go"
          ],
          "functionsToTest": [
            "NeedsJSRendering", "DetectFramework", "HasDynamicContent",
            "hasSPAPattern", "NewTabPool", "Acquire", "Release",
            "Close", "Size", "MaxSize", "DefaultRendererOptions",
            "IsAvailable", "GetBrowserPath", "DefaultStealthOptions", "StealthPage"
          ],
          "coverageTarget": 45,
          "acceptanceCriteria": [
            "Framework detection tested with various HTML patterns",
            "Pool management tested (acquire, release, concurrent access)",
            "Browser availability checks tested",
            "Limited integration test with real browser",
            "Coverage ≥40% for renderer package"
          ]
        }
      ]
    },
    {
      "id": "7",
      "name": "Mock Generation and Infrastructure",
      "description": "Generate mocks for all external dependencies and update CI/CD infrastructure for coverage reporting.",
      "targetCoverage": "N/A",
      "estimatedWeeks": 1,
      "priority": "high",
      "status": "pending",
      "subtasks": [
        {
          "id": "7.1",
          "name": "Generate mocks for external dependencies",
          "description": "Generate mocks using go.uber.org/mock for GitClient, domain interfaces, and all external dependencies.",
          "status": "pending",
          "files": [
            "tests/mocks/git.go",
            "tests/mocks/domain.go",
            "tests/mocks/fetcher.go",
            "tests/mocks/renderer.go"
          ],
          "commands": [
            "mockgen -source=internal/git/client.go -destination=tests/mocks/git.go",
            "mockgen -source=internal/domain/interfaces.go -destination=tests/mocks/domain.go",
            "mockgen -source=internal/fetcher/client.go -destination=tests/mocks/fetcher.go",
            "mockgen -source=internal/renderer/interface.go -destination=tests/mocks/renderer.go"
          ],
          "coverageTarget": 0,
          "acceptanceCriteria": [
            "All mocks generated successfully",
            "Mocks compile without errors",
            "Mocks implement correct interfaces",
            "Used in unit tests"
          ]
        },
        {
          "id": "7.2",
          "name": "Create additional fixtures",
          "description": "Create Git repository fixtures, sitemap fixtures, and llms.txt fixtures for test scenarios.",
          "status": "pending",
          "files": [
            "tests/testdata/fixtures/git/sample_repo.tar.gz",
            "tests/testdata/fixtures/sitemap/sitemap.xml",
            "tests/testdata/fixtures/sitemap/sitemap_index.xml",
            "tests/testdata/fixtures/llms/llms.txt",
            "tests/testdata/fixtures/llms/llms_with_filters.txt"
          ],
          "coverageTarget": 0,
          "acceptanceCriteria": [
            "Git archive fixture created",
            "Sitemap fixtures with various structures",
            "llms.txt fixtures with different formats",
            "Used in integration tests"
          ]
        },
        {
          "id": "7.3",
          "name": "Update CI for coverage reporting",
          "description": "Update GitHub Actions CI workflow to report coverage per package and fail if below threshold.",
          "status": "pending",
          "files": [
            ".github/workflows/ci.yml"
          ],
          "coverageTarget": 0,
          "acceptanceCriteria": [
            "Coverage report generated per package",
            "CI fails if coverage below threshold",
            "Coverage badge updated",
            "Coverage reports uploaded as artifacts"
          ]
        },
        {
          "id": "7.4",
          "name": "Update Makefile with new test targets",
          "description": "Update Makefile to include targets for running new tests and generating coverage reports.",
          "status": "pending",
          "files": [
            "Makefile"
          ],
          "coverageTarget": 0,
          "acceptanceCriteria": [
            "Test targets for new packages added",
            "Coverage generation target added",
            "Individual package test targets added",
            "Documentation updated"
          ]
        }
      ]
    }
  ],
  "qaChecklist": {
    "unitTests": [
      "All unit tests pass with make test",
      "No race detector warnings (go test -race ./...)",
      "Coverage meets or exceeds thresholds for all 12 packages",
      "Tests use table-driven patterns",
      "Tests follow mock injection pattern",
      "Resources properly cleaned up in defer statements"
    ],
    "integrationTests": [
      "All integration tests pass with make test-integration",
      "Integration tests use real dependencies where appropriate",
      "Cache persistence verified",
      "HTTP server integration works",
      "No timing-dependent flaky tests"
    ],
    "coverageVerification": [
      "internal/strategies ≥85%",
      "internal/converter ≥85%",
      "internal/app ≥85%",
      "internal/llm ≥80%",
      "internal/config ≥85%",
      "internal/output ≥80%",
      "internal/cache ≥75%",
      "internal/fetcher ≥70%",
      "internal/git ≥80%",
      "cmd/repodocs ≥80%",
      "internal/domain ≥85%",
      "internal/renderer ≥40%"
    ],
    "codeQuality": [
      "No regressions in existing functionality",
      "Code follows established testing patterns",
      "All fixtures are valid and used",
      "All mocks compile and implement correct interfaces",
      "No security vulnerabilities (no hardcoded credentials)",
      "Test execution time is reasonable (<30s for unit tests)"
    ]
  },
  "edgeCasesToTest": [
    "Malformed HTML with incomplete tags and invalid encoding",
    "Network failures with timeouts, DNS failures, HTTP errors",
    "Empty responses with zero-length content and missing fields",
    "Concurrent access for cache and pool operations",
    "Race conditions in circuit breaker state transitions",
    "Large files (10MB+ HTML, large repositories, massive sitemaps)",
    "Special characters (Unicode, emojis, RTL languages, escape sequences)",
    "Browser crashes and renderer recovery",
    "Git clone failures with invalid URLs and authentication errors",
    "Rate limiting with burst traffic and token bucket exhaustion"
  ],
  "successCriteria": [
    "Phase 1 complete: strategies (85%), converter (85%), app (85%)",
    "Phase 2 complete: llm (80%), config (85%)",
    "Phase 3 complete: output (80%), cache (75%)",
    "Phase 4 complete: fetcher (70%), git (80%)",
    "Phase 5 complete: cmd (80%), domain (85%)",
    "Phase 6 complete: renderer (40-50%)",
    "Phase 7 complete: mocks generated, fixtures created, CI updated",
    "All tests pass with make test-all",
    "No race detector warnings",
    "Coverage report generated per package",
    "CI updated with coverage reporting",
    "All mocks generated and tests compile",
    "Fixtures created and used in tests",
    "Existing tests still pass (no regressions)",
    "New functionality verified via test execution"
  ],
  "estimatedTotalWeeks": 12,
  "nextSteps": [
    "Start with Phase 1, Subtask 1.1: Expand internal/strategies coverage",
    "Run tests incrementally after each subtask completion",
    "Generate coverage reports to verify thresholds",
    "Update progress in build-progress.txt",
    "Document discovered patterns and gotchas"
  ]
}
